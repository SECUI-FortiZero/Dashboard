# intern_full_setup.yaml
# !!! ì´ íŒŒì¼ì€ í˜„ì¬ ê´€ë¦¬ ì¤‘ì¸ ëª¨ë“  í´ë¼ìš°ë“œ ë¦¬ì†ŒìŠ¤ë¥¼ í¬í•¨í•´ì•¼ í•©ë‹ˆë‹¤.

mode: merge          # ğŸ‘ˆ ì¶”ê°€: ê¸°ì¡´ SG ê·œì¹™ê³¼ ë³‘í•©


rules:
  # 1. ì˜¨í”„ë ˆë¯¸ìŠ¤ ë°©í™”ë²½ -> Bastion Host (Public IP)
  - platform: on-premise
    chain: FORWARD
    protocol: tcp
    destination_ip: "3.37.200.119"      # Bastion Hostì˜ ê³µì¸ IP
    port: 22
    source_ip: "192.168.5.40/32"        # ì‚¬ìš©ì PCì˜ ë‚´ë¶€ IP
    action: ACCEPT
    comment: "Allow internal user to access Bastion"

  # 2. ì™¸ë¶€ -> Bastion Host ë³´ì•ˆ ê·¸ë£¹
  - platform: aws
    target_sg: "BastionServerSG"
    protocol: tcp
    port: 22
    source_ip: "211.211.211.211/32"     # ì˜¨í”„ë ˆë¯¸ìŠ¤ ë°©í™”ë²½ì˜ ê³µì¸ IP
    action: allow
    comment: "Allow SSH from On-premise Office"

  # 3. Bastion Host -> FTP ì„œë²„ ë³´ì•ˆ ê·¸ë£¹
  - platform: aws
    target_sg: "FTPServerSG"
    protocol: tcp
    port: 21
    source_sg: "BastionServerSG"
    action: allow
    comment: "Allow FTP Control from Bastion"
  - platform: aws
    target_sg: "FTPServerSG"
    protocol: tcp
    port: "50000-50009"
    source_sg: "BastionServerSG"
    action: allow
    comment: "Allow FTP Passive Data from Bastion"

  # 4. InnerServerSGë¥¼ ê´€ë¦¬ ëŒ€ìƒì— í¬í•¨ (ì‚­ì œ ë°©ì§€)
  #    í˜„ì¬ ì ìš©í•  ê·œì¹™ì´ ì—†ì–´ë„, ì´ë ‡ê²Œ ë¹ˆ ê·œì¹™ì„ ê°€ì§„ ì±„ë¡œ í¬í•¨ì‹œì¼œì•¼ í•©ë‹ˆë‹¤.
  #    ë˜ëŠ” ì‹¤ì œ í•„ìš”í•œ ê·œì¹™ì„ ì¶”ê°€í•´ë„ ë©ë‹ˆë‹¤.
  - platform: aws
    target_sg: "InnerServerSG"
    # ì˜ˆì‹œ: Bastionì—ì„œ 8080 í¬íŠ¸ë¡œ ì ‘ê·¼ í—ˆìš©
    protocol: tcp
    port: 9001
    source_sg: "BastionServerSG"
    action: allow
    comment: "Keep InnerServerSG managed by Terraform"